<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebcamJS Image Capture</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/webcamjs/1.0.26/webcam.min.js"></script>
</head>
<body>

<script>
    // Initialize WebcamJS
    Webcam.set({
        width: 320,
        height: 240,
        image_format: 'jpeg',
        jpeg_quality: 100
    });

    let isCapturing = false;

    function startCapture() {
        Webcam.attach('#my-camera');
        isCapturing = true;
    }

    function stopCapture() {
        Webcam.reset();
        isCapturing = false;
    }

    function captureImage() {
        if (isCapturing) {
            Webcam.snap(function(data_uri) {
                // Display the captured image
                document.getElementById('captured-image').src = data_uri;
            });
        } else {
            alert("Please start capturing first!");
        }
    }

    function downloadImage() {
    if (isCapturing) {
        alert("Please stop capturing before downloading!");
    } else {
        Webcam.snap(function(data_uri) {
            // Convert data URI to Blob
            const byteString = atob(data_uri.split(',')[1]);
            const mimeString = data_uri.split(',')[0].split(':')[1].split(';')[0];
            const arrayBuffer = new ArrayBuffer(byteString.length);
            const uint8Array = new Uint8Array(arrayBuffer);

            for (let i = 0; i < byteString.length; i++) {
                uint8Array[i] = byteString.charCodeAt(i);
            }

            const blob = new Blob([arrayBuffer], { type: mimeString });

            // Create download link
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'captured_image.jpg';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        });
    }
}

</script>
<div class="main" style="width: 100%;text-align: -webkit-center;">
    <div style="width: 100%;text-align: -webkit-center;">
<div id="my-camera"></div>
</div>
<button onclick="startCapture()">Start Capture</button>
<button onclick="stopCapture()">Stop Capture</button>
<button onclick="captureImage()">Capture Image</button>
<button onclick="downloadImage()">Download Image</button>
<img id="captured-image" alt="">
</div>
</body>
</html>
